<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrekWanders - Experience The Magic Of Travel!</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2563eb;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #2563eb;
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.3);
        }

        .btn-outline {
            background: transparent;
            color: #2563eb;
            border: 2px solid #2563eb;
        }

        .btn-outline:hover {
            background: #2563eb;
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        /* Hero Section - Clean Professional Design */
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 8rem 0 4rem;
            text-align: center;
            color: white;
        }

        .hero-text h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .hero-text p {
            font-size: 1.2rem;
            margin-bottom: 3rem;
            opacity: 0.9;
        }

        .hero-search {
            background: white;
            border-radius: 50px;
            padding: 1rem;
            margin: 2rem 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .search-form {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .search-input {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input i {
            position: absolute;
            left: 1rem;
            color: #666;
        }

        .search-input input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            background: #f8f9fa;
        }

        .search-input input:focus {
            outline: none;
            background: white;
            box-shadow: 0 0 0 2px #2563eb;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-top: 3rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: white;
        }

        .stat-item i {
            font-size: 2rem;
            opacity: 0.8;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Search Section */
        .search-section {
            background: white;
            padding: 2rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .search-container {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            border: 2px solid #e5e7eb;
            border-radius: 25px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #2563eb;
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .category-filter {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .category-btn.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        /* Sections */
        .section {
            padding: 5rem 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 3rem;
        }

        .section-title h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 1rem;
        }

        .section-title p {
            font-size: 1.1rem;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Trip Cards */
        .trips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .trip-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
        }

        .trip-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .trip-card-image {
            position: relative;
            height: 250px;
            overflow: hidden;
        }

        .trip-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .trip-card:hover img {
            transform: scale(1.1);
        }

        .trip-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(37, 99, 235, 0.9);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .trip-card-content {
            padding: 1.5rem;
        }

        .trip-card h3 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .trip-location {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .trip-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .stars {
            color: #ffd700;
        }

        .trip-price {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2563eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .trip-duration {
            font-size: 0.8rem;
            color: #666;
            background: #f3f4f6;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 20px;
            width: 95%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            position: relative;
            height: 400px;
            overflow: hidden;
            border-radius: 20px 20px 0 0;
        }

        .modal-image-gallery {
            display: flex;
            height: 100%;
            position: relative;
        }

        .modal-image-gallery img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .modal-image-gallery img.active {
            display: block;
        }

        .image-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 1rem;
            cursor: pointer;
            font-size: 1.2rem;
            border-radius: 50%;
        }

        .image-nav.prev {
            left: 20px;
        }

        .image-nav.next {
            right: 20px;
        }

        .image-indicators {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0.5rem;
        }

        .indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: background 0.3s;
        }

        .indicator.active {
            background: white;
        }

        .close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-info {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .trip-details h2 {
            font-size: 2rem;
            color: #333;
            margin-bottom: 1rem;
        }

        .trip-meta {
            display: flex;
            gap: 2rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #666;
        }

        .trip-description {
            color: #666;
            line-height: 1.8;
            margin-bottom: 2rem;
        }

        .requirements {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .requirements h4 {
            color: #333;
            margin-bottom: 1rem;
        }

        .requirements ul {
            list-style: none;
            padding: 0;
        }

        .requirements li {
            padding: 0.3rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .requirements li i {
            color: #10b981;
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 300px;
            margin: 1.5rem 0;
            border-radius: 15px;
            overflow: hidden;
        }

        .video-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .booking-card {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 20px;
            position: sticky;
            top: 2rem;
        }

        .price-display {
            text-align: center;
            margin-bottom: 2rem;
        }

        .price-amount {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2563eb;
        }

        .price-per {
            color: #666;
            font-size: 0.9rem;
        }

        .booking-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 0.8rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2563eb;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .reviews-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid #e5e7eb;
        }

        .reviews-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .review-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .reviewer-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .reviewer-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #2563eb;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .review-date {
            color: #666;
            font-size: 0.8rem;
        }

        /* Admin Panel */
        .admin-panel {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .admin-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .admin-tab {
            padding: 1rem 2rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .admin-tab.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }

        .admin-content {
            display: none;
        }

        .admin-content.active {
            display: block;
        }

        .admin-form {
            display: grid;
            gap: 1rem;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .image-upload-section {
            border: 2px dashed #e5e7eb;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            margin: 1rem 0;
        }

        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .image-preview img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 10px;
        }

        /* Auth Forms */
        .auth-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .auth-form {
            background: white;
            margin: 10% auto;
            padding: 2rem;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            position: relative;
        }

        .auth-form h2 {
            text-align: center;
            margin-bottom: 2rem;
            color: #333;
        }

        .user-info {
            display: none;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #2563eb;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .role-badge {
            background: #10b981;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .role-badge.admin {
            background: #ef4444;
        }

        /* Tab System */
        .tab-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 0.8rem 1.5rem;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-button.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .admin-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 0.5rem;
        }

        .admin-btn {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background 0.3s;
        }

        .admin-btn:hover {
            background: rgba(0, 0, 0, 0.9);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-content {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .hero-text h1 {
                font-size: 2.5rem;
            }

            .nav-links {
                display: none;
            }

            .trips-grid {
                grid-template-columns: 1fr;
            }

            .modal-info {
                grid-template-columns: 1fr;
            }

            .search-container {
                flex-direction: column;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .tab-buttons {
                flex-wrap: wrap;
            }

            .category-filter {
                justify-content: center;
            }
        }

        .hidden {
            display: none !important;
        }

        .success-message {
            background: #10b981;
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: center;
        }

        .error-message {
            background: #ef4444;
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: center;
        }

        /* Feed Section */
        .feed-section {
            background: #f8f9fa;
            padding: 4rem 0;
        }

        .feed-post {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .feed-post:hover {
            transform: translateY(-5px);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .post-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #2563eb;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .post-info h4 {
            margin: 0;
            color: #333;
        }

        .post-date {
            color: #666;
            font-size: 0.9rem;
        }

        .post-content {
            margin-bottom: 1.5rem;
        }

        .post-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 15px;
            margin: 1rem 0;
        }

        .post-actions {
            display: flex;
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #666;
            cursor: pointer;
            transition: color 0.3s;
        }

        .post-action:hover {
            color: #2563eb;
        }

        .add-post-form {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: none;
        }



        /* Utility Classes */
        .cursor-pointer {
            cursor: pointer;
        }

        .text-center {
            text-align: center;
        }

        .mt-2 {
            margin-top: 1rem;
        }

        .mb-2 {
            margin-bottom: 1rem;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <nav class="container">
            <div class="logo">
                <i class="fas fa-mountain"></i> TrekWanders
            </div>
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="#destinations">Destinations</a></li>
                <li><a href="#feed">Feed</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
            <div class="auth-buttons">
                <div class="user-info" id="userInfo">
                    <div class="user-avatar" id="userAvatar"></div>
                    <div>
                        <div id="userName"></div>
                        <div class="role-badge" id="userRole">User</div>
                    </div>
                    <button class="btn btn-outline" onclick="logout()">Logout</button>
                </div>
                <div id="authButtons">
                    <button class="btn btn-outline" onclick="openAuthModal('login')">Login</button>
                    <button class="btn btn-primary" onclick="openAuthModal('signup')">Sign Up</button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container">
            <div class="hero-content">
                <div class="hero-text">
                    <h1>Discover Your Next Adventure</h1>
                    <p>Find and book amazing travel experiences around the world with TrekWanders</p>
                    <div class="hero-search">
                        <div class="search-form">
                            <div class="search-input">
                                <i class="fas fa-map-marker-alt"></i>
                                <input type="text" placeholder="Where do you want to go?" id="heroSearchInput">
                            </div>
                            <div class="search-input">
                                <i class="fas fa-calendar-alt"></i>
                                <input type="date" id="heroDateInput">
                            </div>
                            <button class="btn btn-primary" onclick="searchTrips()">
                                <i class="fas fa-search"></i> Search
                            </button>
                        </div>
                    </div>
                    <div class="hero-stats">
                        <div class="stat-item">
                            <i class="fas fa-map-marked-alt"></i>
                            <div>
                                <span class="stat-number">1000+</span>
                                <span class="stat-label">Destinations</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-users"></i>
                            <div>
                                <span class="stat-number">50K+</span>
                                <span class="stat-label">Happy Travelers</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-star"></i>
                            <div>
                                <span class="stat-number">4.9</span>
                                <span class="stat-label">Average Rating</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Search Section -->
    <section class="search-section">
        <div class="container">
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search destinations, activities, or locations...">
                </div>
                <div class="category-filter">
                    <button class="category-btn active" data-category="all">All</button>
                    <button class="category-btn" data-category="adventure">Adventure</button>
                    <button class="category-btn" data-category="hiking">Hiking</button>
                    <button class="category-btn" data-category="temple">Temple</button>
                    <button class="category-btn" data-category="beach">Beach</button>
                    <button class="category-btn" data-category="mountain">Mountain</button>
                    <button class="category-btn" data-category="cultural">Cultural</button>
                    <button class="category-btn" data-category="wildlife">Wildlife</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Admin Panel -->
    <div class="admin-panel container" id="adminPanel">
        <h2><i class="fas fa-cog"></i> Admin Panel</h2>
        
                 <div class="admin-tabs">
             <button class="admin-tab active" onclick="showAdminTab('dashboard')"><i class="fas fa-chart-line"></i> Dashboard</button>
             <button class="admin-tab" onclick="showAdminTab('trips')"><i class="fas fa-map-marked-alt"></i> Manage Trips</button>
             <button class="admin-tab" onclick="showAdminTab('bookings')"><i class="fas fa-calendar-check"></i> Bookings</button>
             <button class="admin-tab" onclick="showAdminTab('users')"><i class="fas fa-users"></i> Users</button>
             <button class="admin-tab" onclick="showAdminTab('analytics')"><i class="fas fa-analytics"></i> Analytics</button>
         </div>

                 <!-- Dashboard -->
         <div class="admin-content active" id="dashboardAdmin">
             <div class="dashboard-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                 <div class="stat-card" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 2rem; border-radius: 15px; text-align: center;">
                     <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                     <h3 id="totalUsers">0</h3>
                     <p>Total Users</p>
                 </div>
                 <div class="stat-card" style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white; padding: 2rem; border-radius: 15px; text-align: center;">
                     <i class="fas fa-calendar-check" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                     <h3 id="totalBookings">0</h3>
                     <p>Total Bookings</p>
                 </div>
                 <div class="stat-card" style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; padding: 2rem; border-radius: 15px; text-align: center;">
                     <i class="fas fa-map-marked-alt" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                     <h3 id="totalTrips">0</h3>
                     <p>Total Trips</p>
                 </div>
                 <div class="stat-card" style="background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; padding: 2rem; border-radius: 15px; text-align: center;">
                     <i class="fas fa-dollar-sign" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                     <h3 id="totalRevenue">$0</h3>
                     <p>Revenue</p>
                 </div>
             </div>
             
             <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                 <div style="background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                     <h3>Recent Bookings</h3>
                     <div id="recentBookings">Loading...</div>
                 </div>
                 <div style="background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                     <h3>Popular Destinations</h3>
                     <canvas id="destinationChart" width="400" height="200"></canvas>
                 </div>
             </div>
         </div>

         <!-- Trip Management -->
         <div class="admin-content" id="tripsAdmin">
            <form class="admin-form" id="adminForm">
                <div class="form-group">
                    <label for="tripTitle">Trip Title</label>
                    <input type="text" id="tripTitle" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="tripLocation">Location</label>
                        <input type="text" id="tripLocation" required>
                    </div>
                    <div class="form-group">
                        <label for="tripDuration">Duration</label>
                        <input type="text" id="tripDuration" placeholder="e.g., 5 Days 4 Nights" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="tripImages">Image URLs (one per line)</label>
                    <textarea id="tripImages" rows="4" placeholder="Enter multiple image URLs, one per line" required></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="tripPrice">Price</label>
                        <input type="text" id="tripPrice" placeholder="e.g., $2,999" required>
                    </div>
                    <div class="form-group">
                        <label for="tripRating">Rating (1-5)</label>
                        <input type="number" id="tripRating" min="1" max="5" step="0.1" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="tripDescription">Description</label>
                    <textarea id="tripDescription" rows="4" required></textarea>
                </div>

                <div class="form-group">
                    <label for="tripRequirements">Requirements (one per line)</label>
                    <textarea id="tripRequirements" rows="4" placeholder="e.g., Valid Passport&#10;Good Physical Fitness&#10;Travel Insurance"></textarea>
                </div>

                <div class="form-group">
                    <label for="tripVideo">Video URL (YouTube)</label>
                    <input type="url" id="tripVideo" placeholder="https://www.youtube.com/embed/...">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="tripCategory">Trip Category</label>
                        <select id="tripCategory" required>
                            <option value="adventure">Adventure</option>
                            <option value="hiking">Hiking</option>
                            <option value="temple">Temple</option>
                            <option value="beach">Beach</option>
                            <option value="mountain">Mountain</option>
                            <option value="cultural">Cultural</option>
                            <option value="wildlife">Wildlife</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tripSection">Section</label>
                        <select id="tripSection" required>
                            <option value="trending">Trending</option>
                            <option value="upcoming">Upcoming</option>
                            <option value="ongoing">Ongoing</option>
                            <option value="past">Past</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">
                    <span id="adminSubmitText">Add Trip</span>
                    <div class="loading" id="adminLoading" style="display: none;"></div>
                </button>
            </form>
        </div>

                 <!-- Booking Management -->
         <div class="admin-content" id="bookingsAdmin">
             <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                 <h3>Booking Management</h3>
                 <div>
                     <button class="btn btn-primary" onclick="exportBookings()"><i class="fas fa-download"></i> Export</button>
                     <select id="bookingStatusFilter" onchange="filterBookings()" style="margin-left: 1rem; padding: 0.5rem; border-radius: 5px;">
                         <option value="all">All Bookings</option>
                         <option value="pending">Pending</option>
                         <option value="confirmed">Confirmed</option>
                         <option value="cancelled">Cancelled</option>
                     </select>
                 </div>
             </div>
             
             <div class="bookings-table" style="background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                 <table style="width: 100%; border-collapse: collapse;">
                     <thead style="background: #f8f9fa;">
                         <tr>
                             <th style="padding: 1rem; text-align: left; border-bottom: 1px solid #e5e7eb;">Booking ID</th>
                             <th style="padding: 1rem; text-align: left; border-bottom: 1px solid #e5e7eb;">Customer</th>
                             <th style="padding: 1rem; text-align: left; border-bottom: 1px solid #e5e7eb;">Trip</th>
                             <th style="padding: 1rem; text-align: left; border-bottom: 1px solid #e5e7eb;">Date</th>
                             <th style="padding: 1rem; text-align: left; border-bottom: 1px solid #e5e7eb;">Status</th>
                             <th style="padding: 1rem; text-align: left; border-bottom: 1px solid #e5e7eb;">Actions</th>
                         </tr>
                     </thead>
                     <tbody id="bookingsTableBody">
                         <tr>
                             <td colspan="6" style="padding: 2rem; text-align: center; color: #666;">Loading bookings...</td>
                         </tr>
                     </tbody>
                 </table>
             </div>
         </div>

         <!-- Analytics -->
         <div class="admin-content" id="analyticsAdmin">
             <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                 <div style="background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                     <h3>Booking Trends</h3>
                     <canvas id="bookingTrendsChart" width="400" height="200"></canvas>
                 </div>
                 <div style="background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                     <h3>Revenue by Month</h3>
                     <canvas id="revenueChart" width="400" height="200"></canvas>
                 </div>
             </div>
             
             <div style="background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                 <h3>User Activity</h3>
                 <canvas id="userActivityChart" width="800" height="300"></canvas>
             </div>
         </div>

        <!-- User Role Management -->
        <div class="admin-content" id="usersAdmin">
            <h3>User Role Management</h3>
            <div id="usersList">
                <!-- Users will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Destinations Section -->
    <section class="section" id="destinations">
        <div class="container">
            <div class="section-title">
                <h2>Popular Destinations</h2>
                <p>Unleash Your Wanderlust With TrekWanders</p>
            </div>

            <div class="tab-buttons">
                <button class="tab-button active" onclick="showTab('trending')">Trending</button>
                <button class="tab-button" onclick="showTab('ongoing')">Ongoing</button>
                <button class="tab-button" onclick="showTab('upcoming')">Upcoming</button>
                <button class="tab-button" onclick="showTab('past')">Past Adventures</button>
            </div>

            <div class="tab-content active" id="trending">
                <div class="trips-grid" id="trendingTrips">
                    <!-- Trending trips will be loaded here -->
                </div>
            </div>

            <div class="tab-content" id="ongoing">
                <div class="trips-grid" id="ongoingTrips">
                    <!-- Ongoing trips will be loaded here -->
                </div>
            </div>

            <div class="tab-content" id="upcoming">
                <div class="trips-grid" id="upcomingTrips">
                    <!-- Upcoming trips will be loaded here -->
                </div>
            </div>

            <div class="tab-content" id="past">
                <div class="trips-grid" id="pastTrips">
                    <!-- Past trips will be loaded here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Feed Section -->
    <section class="feed-section section" id="feed">
        <div class="container">
            <div class="section-title">
                <h2>Travel Feed</h2>
                <p>Latest updates, stories, and announcements from TrekWanders</p>
            </div>

            <!-- Add Post Form (Admin Only) -->
            <div class="add-post-form" id="addPostForm">
                <h3>Create New Post</h3>
                <form id="feedPostForm">
                    <div class="form-group">
                        <label for="postTitle">Post Title</label>
                        <input type="text" id="postTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="postContent">Content</label>
                        <textarea id="postContent" rows="4" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="postImage">Image URL (optional)</label>
                        <input type="url" id="postImage">
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button type="submit" class="btn btn-primary">Post</button>
                        <button type="button" class="btn btn-outline" onclick="hideAddPostForm()">Cancel</button>
                    </div>
                </form>
            </div>

            <div style="text-align: center; margin-bottom: 2rem;">
                <button class="btn btn-primary" onclick="showAddPostForm()" id="addPostBtn" style="display: none;">
                    <i class="fas fa-plus"></i> Add New Post
                </button>
            </div>

            <div id="feedPosts">
                <!-- Feed posts will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Trip Details Modal -->
    <div id="tripModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-image-gallery" id="modalImageGallery">
                    <!-- Images will be loaded here -->
                </div>
                <button class="image-nav prev" onclick="previousImage()">❮</button>
                <button class="image-nav next" onclick="nextImage()">❯</button>
                <div class="image-indicators" id="imageIndicators">
                    <!-- Indicators will be loaded here -->
                </div>
                <span class="close">&times;</span>
                <div class="admin-actions" id="modalAdminActions" style="display: none;">
                    <button class="admin-btn" onclick="editTrip()"><i class="fas fa-edit"></i></button>
                    <button class="admin-btn" onclick="deleteTrip()"><i class="fas fa-trash"></i></button>
                </div>
            </div>
            <div class="modal-body">
                <div class="modal-info">
                    <div class="trip-details">
                        <h2 id="modalTitle"></h2>
                        <div class="trip-meta">
                            <div class="meta-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span id="modalLocation"></span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-clock"></i>
                                <span id="modalDuration"></span>
                            </div>
                            <div class="meta-item">
                                <div class="stars" id="modalStars"></div>
                                <span id="modalRating"></span>
                            </div>
                        </div>
                        <div class="trip-description" id="modalDescription"></div>
                        
                        <div class="requirements" id="modalRequirements">
                            <h4><i class="fas fa-list-check"></i> Requirements</h4>
                            <ul id="requirementsList">
                                <!-- Requirements will be loaded here -->
                            </ul>
                        </div>

                        <div class="video-container" id="modalVideoContainer" style="display: none;">
                            <iframe id="modalVideo" src="" allowfullscreen></iframe>
                        </div>
                    </div>

                    <div class="booking-card">
                        <div class="price-display">
                            <div class="price-amount" id="modalPrice"></div>
                            <div class="price-per">per person</div>
                        </div>
                        
                        <form class="booking-form" id="bookingForm">
                            <div class="form-group">
                                <label for="bookingName">Full Name *</label>
                                <input type="text" id="bookingName" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="bookingEmail">Email *</label>
                                <input type="email" id="bookingEmail" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="bookingPhone">Phone Number *</label>
                                <input type="tel" id="bookingPhone" required>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="adultCount">Adults</label>
                                    <select id="adultCount">
                                        <option value="1">1 Adult</option>
                                        <option value="2">2 Adults</option>
                                        <option value="3">3 Adults</option>
                                        <option value="4">4 Adults</option>
                                        <option value="5">5+ Adults</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="childCount">Children</label>
                                    <select id="childCount">
                                        <option value="0">0 Children</option>
                                        <option value="1">1 Child</option>
                                        <option value="2">2 Children</option>
                                        <option value="3">3 Children</option>
                                        <option value="4">4+ Children</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="seniorCount">Seniors (60+)</label>
                                    <select id="seniorCount">
                                        <option value="0">0 Seniors</option>
                                        <option value="1">1 Senior</option>
                                        <option value="2">2 Seniors</option>
                                        <option value="3">3+ Seniors</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="genderMix">Group Composition</label>
                                    <select id="genderMix">
                                        <option value="mixed">Mixed Group</option>
                                        <option value="male">All Male</option>
                                        <option value="female">All Female</option>
                                        <option value="family">Family</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="bookingDate">Preferred Date</label>
                                <input type="date" id="bookingDate" required>
                            </div>

                            <div class="form-group">
                                <label for="specialRequests">Special Requests</label>
                                <textarea id="specialRequests" rows="3" placeholder="Any dietary restrictions, medical conditions, or special requirements..."></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary" style="width: 100%;">
                                <i class="fas fa-ticket-alt"></i> Book Now
                                <div class="loading" id="bookingLoading" style="display: none;"></div>
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Reviews Section -->
                <div class="reviews-section">
                    <div class="reviews-header">
                        <h3><i class="fas fa-star"></i> Reviews & Ratings</h3>
                        <button class="btn btn-outline" onclick="showAddReviewForm()" id="addReviewBtn">Add Review</button>
                    </div>
                    
                    <div id="addReviewForm" class="review-card" style="display: none;">
                        <form id="reviewForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="reviewRating">Rating</label>
                                    <select id="reviewRating" required>
                                        <option value="5">5 Stars - Excellent</option>
                                        <option value="4">4 Stars - Very Good</option>
                                        <option value="3">3 Stars - Good</option>
                                        <option value="2">2 Stars - Fair</option>
                                        <option value="1">1 Star - Poor</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="reviewTitle">Review Title</label>
                                    <input type="text" id="reviewTitle" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="reviewText">Your Review</label>
                                <textarea id="reviewText" rows="4" required></textarea>
                            </div>
                            <div style="display: flex; gap: 1rem;">
                                <button type="submit" class="btn btn-primary">
                                    Submit Review
                                    <div class="loading" id="reviewLoading" style="display: none;"></div>
                                </button>
                                <button type="button" class="btn btn-outline" onclick="hideAddReviewForm()">Cancel</button>
                            </div>
                        </form>
                    </div>

                    <div id="reviewsList">
                        <!-- Reviews will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="auth-modal">
        <div class="auth-form">
            <span class="close" onclick="closeAuthModal()">&times;</span>
            <h2 id="authTitle">Login</h2>
            <form id="authFormElement">
                <div class="form-group" id="usernameField" style="display: none;">
                    <label for="authUsername">Username</label>
                    <input type="text" id="authUsername">
                </div>
                <div class="form-group">
                    <label for="authEmail">Email</label>
                    <input type="email" id="authEmail" required>
                </div>
                <div class="form-group" id="phoneField" style="display: none;">
                    <label for="authPhone">Phone Number</label>
                    <input type="tel" id="authPhone">
                </div>
                <div class="form-group">
                    <label for="authPassword">Password</label>
                    <input type="password" id="authPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <span id="authSubmitText">Login</span>
                    <div class="loading" id="authLoading" style="display: none;"></div>
                </button>
            </form>
            <p style="text-align: center; margin-top: 1rem;">
                <span id="authSwitchText">Don't have an account?</span>
                <a href="#" id="authSwitchLink" onclick="switchAuthMode()">Sign up</a>
            </p>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>
    
    <!-- SweetAlert2 for beautiful alerts - Free CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Chart.js for analytics - Free CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Toastify for notifications - Free and unlimited -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAL5e-5eQfgf1nI6hWTnhwLFgK0Cp89aa0",
            authDomain: "aviator-pr01.firebaseapp.com",
            databaseURL: "https://aviator-pr01-default-rtdb.firebaseio.com",
            projectId: "aviator-pr01",
            storageBucket: "aviator-pr01.firebasestorage.app",
            messagingSenderId: "290788041297",
            appId: "1:290788041297:web:168f99d1532997fb778e70",
            measurementId: "G-ENCBTT4BL8"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const database = firebase.database();
        const storage = firebase.storage();

        let currentUser = null;
        let isAdmin = false;
        let currentTripId = null;
        let authMode = 'login';
        let currentImageIndex = 0;
        let currentTripImages = [];
        let allTrips = [];
        let filteredTrips = [];
        let currentTripLocation = '';



        // Sample trips data with enhanced features
        const sampleTrips = [
            {
                id: 'sample1',
                title: 'Himalayan Adventure Trek',
                location: 'Nepal Himalayas',
                duration: '12 Days 11 Nights',
                images: [
                    'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1544735716-392fe2489ffa?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1571863533956-01c88e79957e?w=800&h=600&fit=crop'
                ],
                price: '$2,499',
                rating: 4.9,
                description: 'Embark on an unforgettable journey through the majestic Himalayas. Experience breathtaking mountain views, ancient monasteries, and the warm hospitality of Sherpa communities.',
                requirements: ['Valid Passport', 'Good Physical Fitness', 'Travel Insurance', 'Warm Clothing', 'Trekking Experience'],
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                category: 'adventure',
                section: 'trending'
            },
            {
                id: 'sample2',
                title: 'Sacred Temple Journey',
                location: 'Varanasi, India',
                duration: '7 Days 6 Nights',
                images: [
                    'https://images.unsplash.com/photo-1564507592333-c60657eea523?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1524492412937-b28074a5d7da?w=800&h=600&fit=crop'
                ],
                price: '$899',
                rating: 4.7,
                description: 'Discover the spiritual heart of India with visits to ancient temples, evening aarti ceremonies, and peaceful meditation sessions along the sacred Ganges.',
                requirements: ['Respectful Attire', 'Open Mind', 'Comfortable Walking Shoes'],
                category: 'temple',
                section: 'upcoming'
            },
            {
                id: 'sample3',
                title: 'Tropical Paradise Escape',
                location: 'Maldives',
                duration: '5 Days 4 Nights',
                images: [
                    'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&h=600&fit=crop'
                ],
                price: '$3,299',
                rating: 4.8,
                description: 'Experience ultimate luxury in overwater bungalows with crystal clear waters, pristine beaches, and world-class diving.',
                requirements: ['Swimming Ability', 'Sun Protection', 'Snorkeling Gear Provided'],
                category: 'beach',
                section: 'ongoing'
            }
        ];

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadSampleTrips();
            loadSampleFeedPosts();
            setupEventListeners();
            initializeFreeFeatures();
            
            // Check authentication state
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    checkUserRole(user);
                } else {
                    currentUser = null;
                    isAdmin = false;
                    updateUIForGuest();
                }
            });
        });

        async function checkUserRole(user) {
            try {
                // Check user role in Realtime Database
                const userRef = database.ref('users/' + user.uid);
                const snapshot = await userRef.once('value');
                
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    isAdmin = userData.role === 'admin';
                    
                    // Update last login
                    await userRef.update({
                        lastLogin: firebase.database.ServerValue.TIMESTAMP
                    });
                } else {
                    // Create user document with default role and complete data in Realtime Database
                    const userData = {
                        email: user.email,
                        uid: user.uid,
                        role: 'user',
                        joinDate: firebase.database.ServerValue.TIMESTAMP,
                        createdAt: firebase.database.ServerValue.TIMESTAMP,
                        displayName: user.displayName || user.email.split('@')[0],
                        lastLogin: firebase.database.ServerValue.TIMESTAMP,
                        profilePicture: user.photoURL || '',
                        isActive: true
                    };
                    
                    await userRef.set(userData);
                    isAdmin = false;
                }
                
                updateUIForUser(user);
                if (isAdmin) {
                    loadTripsFromFirestore();
                    loadUsersList();
                    loadFeedPosts();
                }
            } catch (error) {
                console.error('Error checking user role:', error);
                isAdmin = false;
                updateUIForUser(user);
            }
        }

        function loadSampleTrips() {
            allTrips = [...sampleTrips];
            filteredTrips = [...allTrips];
            renderTrips();
        }

        function renderTrips() {
            const containers = {
                trending: document.getElementById('trendingTrips'),
                ongoing: document.getElementById('ongoingTrips'),
                upcoming: document.getElementById('upcomingTrips'),
                past: document.getElementById('pastTrips')
            };

            // Clear containers
            Object.values(containers).forEach(container => {
                container.innerHTML = '';
            });

            // Render filtered trips
            filteredTrips.forEach(trip => {
                const tripCard = createTripCard(trip);
                if (containers[trip.section]) {
                    containers[trip.section].appendChild(tripCard);
                }
            });
        }

        function setupEventListeners() {
            // Auth form submission
            document.getElementById('authFormElement').addEventListener('submit', handleAuth);
            
            // Admin form submission
            document.getElementById('adminForm').addEventListener('submit', handleAdminSubmit);
            
            // Booking form submission
            document.getElementById('bookingForm').addEventListener('submit', handleBookingSubmit);
            
            // Review form submission
            document.getElementById('reviewForm').addEventListener('submit', handleReviewSubmit);
            
            // Feed form submission
            document.getElementById('feedPostForm').addEventListener('submit', handleFeedPostSubmit);
            
            // Search functionality
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            
            // Category filter
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', handleCategoryFilter);
            });
            
            // Modal close events
            document.querySelectorAll('.close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    this.closest('.modal, .auth-modal').style.display = 'none';
                });
            });
            
            // Click outside modal to close
            window.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal') || event.target.classList.contains('auth-modal')) {
                    event.target.style.display = 'none';
                }
            });
        }

        function handleSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            filteredTrips = allTrips.filter(trip => 
                trip.title.toLowerCase().includes(searchTerm) ||
                trip.location.toLowerCase().includes(searchTerm) ||
                trip.category.toLowerCase().includes(searchTerm) ||
                trip.description.toLowerCase().includes(searchTerm)
            );
            renderTrips();
        }

        function handleCategoryFilter(event) {
            // Update active button
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const category = event.target.dataset.category;
            if (category === 'all') {
                filteredTrips = [...allTrips];
            } else {
                filteredTrips = allTrips.filter(trip => trip.category === category);
            }
            renderTrips();
        }

        function updateUIForUser(user) {
            document.getElementById('authButtons').style.display = 'none';
            document.getElementById('userInfo').style.display = 'flex';
            document.getElementById('userName').textContent = user.displayName || user.email.split('@')[0];
            document.getElementById('userAvatar').textContent = (user.displayName || user.email)[0].toUpperCase();
            
            const roleElement = document.getElementById('userRole');
            if (isAdmin) {
                roleElement.textContent = 'Admin';
                roleElement.classList.add('admin');
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('addPostBtn').style.display = 'inline-block';
                document.querySelectorAll('.admin-actions').forEach(el => el.style.display = 'flex');
            } else {
                roleElement.textContent = 'User';
                roleElement.classList.remove('admin');
                document.getElementById('addPostBtn').style.display = 'none';
            }
        }

        function updateUIForGuest() {
            document.getElementById('authButtons').style.display = 'flex';
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('addPostBtn').style.display = 'none';
            document.querySelectorAll('.admin-actions').forEach(el => el.style.display = 'none');
        }

        function openAuthModal(mode) {
            authMode = mode;
            document.getElementById('authModal').style.display = 'flex';
            
            if (mode === 'login') {
                document.getElementById('authTitle').textContent = 'Login';
                document.getElementById('authSubmitText').textContent = 'Login';
                document.getElementById('authSwitchText').textContent = "Don't have an account?";
                document.getElementById('authSwitchLink').textContent = 'Sign up';
                document.getElementById('usernameField').style.display = 'none';
                document.getElementById('phoneField').style.display = 'none';
                document.getElementById('authUsername').required = false;
                document.getElementById('authPhone').required = false;
            } else {
                document.getElementById('authTitle').textContent = 'Sign Up';
                document.getElementById('authSubmitText').textContent = 'Sign Up';
                document.getElementById('authSwitchText').textContent = 'Already have an account?';
                document.getElementById('authSwitchLink').textContent = 'Login';
                document.getElementById('usernameField').style.display = 'block';
                document.getElementById('phoneField').style.display = 'block';
                document.getElementById('authUsername').required = true;
                document.getElementById('authPhone').required = true;
            }
        }

        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('authFormElement').reset();
        }

        function switchAuthMode() {
            authMode = authMode === 'login' ? 'signup' : 'login';
            openAuthModal(authMode);
        }

        async function handleAuth(e) {
            e.preventDefault();
            
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            
            document.getElementById('authLoading').style.display = 'inline-block';
            document.getElementById('authSubmitText').style.display = 'none';
            
            try {
                if (authMode === 'login') {
                    await auth.signInWithEmailAndPassword(email, password);
                } else {
                    const username = document.getElementById('authUsername').value;
                    const phone = document.getElementById('authPhone').value;
                    
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    // Set default role as user with complete data in Realtime Database
                    const userRef = database.ref('users/' + userCredential.user.uid);
                    await userRef.set({
                        email: email,
                        uid: userCredential.user.uid,
                        username: username,
                        phone: phone,
                        role: 'user',
                        joinDate: firebase.database.ServerValue.TIMESTAMP,
                        createdAt: firebase.database.ServerValue.TIMESTAMP,
                        displayName: username || email.split('@')[0],
                        lastLogin: firebase.database.ServerValue.TIMESTAMP,
                        profilePicture: '',
                        isActive: true
                    });
                }
                closeAuthModal();
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                document.getElementById('authLoading').style.display = 'none';
                document.getElementById('authSubmitText').style.display = 'inline';
            }
        }

        function logout() {
            auth.signOut();
        }

        function showTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
        }

        function showAdminTab(tabName) {
            // Update admin tab buttons
            document.querySelectorAll('.admin-tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update admin tab content
            document.querySelectorAll('.admin-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + 'Admin').classList.add('active');
        }

        function createTripCard(trip) {
            const card = document.createElement('div');
            card.className = 'trip-card';
            card.onclick = () => openTripModal(trip);
            
            const stars = '★'.repeat(Math.floor(trip.rating)) + '☆'.repeat(5 - Math.floor(trip.rating));
            const mainImage = Array.isArray(trip.images) ? trip.images[0] : trip.images;
            
            card.innerHTML = `
                ${isAdmin ? `
                <div class="admin-actions">
                    <button class="admin-btn" onclick="event.stopPropagation(); editTrip('${trip.id}')"><i class="fas fa-edit"></i></button>
                    <button class="admin-btn" onclick="event.stopPropagation(); deleteTrip('${trip.id}')"><i class="fas fa-trash"></i></button>
                </div>
                ` : ''}
                <div class="trip-card-image">
                    <img src="${mainImage}" alt="${trip.title}">
                    <div class="trip-badge">${trip.category}</div>
                </div>
                <div class="trip-card-content">
                    <h3>${trip.title}</h3>
                    <div class="trip-location">
                        <i class="fas fa-map-marker-alt"></i>
                        ${trip.location}
                    </div>
                    <div class="trip-rating">
                        <div class="stars">${stars}</div>
                        <span>${trip.rating}</span>
                    </div>
                    <div class="trip-price">
                        <span>${trip.price}</span>
                        <span class="trip-duration">${trip.duration || ''}</span>
                    </div>
                </div>
            `;
            
            return card;
        }

        function openTripModal(trip) {
            currentTripId = trip.id;
            currentTripLocation = trip.location;
            currentTripImages = Array.isArray(trip.images) ? trip.images : [trip.images];
            currentImageIndex = 0;
            
            // Setup image gallery
            setupImageGallery();
            
            // Fill trip details
            document.getElementById('modalTitle').textContent = trip.title;
            document.getElementById('modalLocation').textContent = trip.location;
            document.getElementById('modalDuration').textContent = trip.duration || '';
            document.getElementById('modalRating').textContent = trip.rating;
            document.getElementById('modalPrice').textContent = trip.price;
            document.getElementById('modalDescription').textContent = trip.description;
            
            const stars = '★'.repeat(Math.floor(trip.rating)) + '☆'.repeat(5 - Math.floor(trip.rating));
            document.getElementById('modalStars').textContent = stars;
            
            // Setup requirements
            if (trip.requirements && trip.requirements.length > 0) {
                const requirementsList = document.getElementById('requirementsList');
                requirementsList.innerHTML = '';
                trip.requirements.forEach(req => {
                    const li = document.createElement('li');
                    li.innerHTML = `<i class="fas fa-check"></i> ${req}`;
                    requirementsList.appendChild(li);
                });
                document.getElementById('modalRequirements').style.display = 'block';
            } else {
                document.getElementById('modalRequirements').style.display = 'none';
            }
            
            // Setup video
            if (trip.videoUrl) {
                document.getElementById('modalVideoContainer').style.display = 'block';
                document.getElementById('modalVideo').src = trip.videoUrl;
            } else {
                document.getElementById('modalVideoContainer').style.display = 'none';
            }
            
            // Show admin actions if admin
            if (isAdmin) {
                document.getElementById('modalAdminActions').style.display = 'flex';
            }
            
            // Load reviews
            loadTripReviews(trip.id);
            
            document.getElementById('tripModal').style.display = 'flex';
        }

        function setupImageGallery() {
            const gallery = document.getElementById('modalImageGallery');
            const indicators = document.getElementById('imageIndicators');
            
            gallery.innerHTML = '';
            indicators.innerHTML = '';
            
            currentTripImages.forEach((image, index) => {
                // Create image element
                const img = document.createElement('img');
                img.src = image;
                img.className = index === 0 ? 'active' : '';
                gallery.appendChild(img);
                
                // Create indicator
                const indicator = document.createElement('div');
                indicator.className = `indicator ${index === 0 ? 'active' : ''}`;
                indicator.onclick = () => showImage(index);
                indicators.appendChild(indicator);
            });
        }

        function showImage(index) {
            currentImageIndex = index;
            
            // Update images
            document.querySelectorAll('#modalImageGallery img').forEach((img, i) => {
                img.classList.toggle('active', i === index);
            });
            
            // Update indicators
            document.querySelectorAll('.indicator').forEach((indicator, i) => {
                indicator.classList.toggle('active', i === index);
            });
        }

        function previousImage() {
            const newIndex = currentImageIndex > 0 ? currentImageIndex - 1 : currentTripImages.length - 1;
            showImage(newIndex);
        }

        function nextImage() {
            const newIndex = currentImageIndex < currentTripImages.length - 1 ? currentImageIndex + 1 : 0;
            showImage(newIndex);
        }

        async function handleAdminSubmit(e) {
            e.preventDefault();
            
            if (!isAdmin) {
                alert('Access denied. Admin privileges required.');
                return;
            }
            
            const images = document.getElementById('tripImages').value.split('\n').filter(url => url.trim());
            const requirements = document.getElementById('tripRequirements').value.split('\n').filter(req => req.trim());
            
            const tripData = {
                title: document.getElementById('tripTitle').value,
                location: document.getElementById('tripLocation').value,
                duration: document.getElementById('tripDuration').value,
                images: images,
                price: document.getElementById('tripPrice').value,
                rating: parseFloat(document.getElementById('tripRating').value),
                description: document.getElementById('tripDescription').value,
                requirements: requirements,
                videoUrl: document.getElementById('tripVideo').value,
                category: document.getElementById('tripCategory').value,
                section: document.getElementById('tripSection').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                createdBy: currentUser.email
            };
            
            document.getElementById('adminLoading').style.display = 'inline-block';
            document.getElementById('adminSubmitText').style.display = 'none';
            
            try {
                // Save to both Firestore and Realtime Database
                await db.collection('trips').add(tripData);
                await database.ref('trips').push(tripData);
                
                document.getElementById('adminForm').reset();
                loadTripsFromFirestore();
                
                sendFreeNotification('Success', 'Trip added successfully!', 'success');
            } catch (error) {
                console.error('Error adding trip:', error);
                sendFreeNotification('Error', 'Failed to add trip: ' + error.message, 'error');
            } finally {
                document.getElementById('adminLoading').style.display = 'none';
                document.getElementById('adminSubmitText').style.display = 'inline';
            }
        }

        async function handleBookingSubmit(e) {
            e.preventDefault();
            
            if (!currentUser) {
                alert('Please login to book a trip.');
                return;
            }

            // Show loading state
            document.getElementById('bookingLoading').style.display = 'inline-block';
            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            
            const bookingData = {
                tripId: currentTripId,
                userId: currentUser.uid,
                userEmail: currentUser.email,
                name: document.getElementById('bookingName').value,
                email: document.getElementById('bookingEmail').value,
                phone: document.getElementById('bookingPhone').value,
                adults: parseInt(document.getElementById('adultCount').value),
                children: parseInt(document.getElementById('childCount').value),
                seniors: parseInt(document.getElementById('seniorCount').value),
                genderMix: document.getElementById('genderMix').value,
                preferredDate: document.getElementById('bookingDate').value,
                specialRequests: document.getElementById('specialRequests').value,
                bookingDate: firebase.database.ServerValue.TIMESTAMP,
                status: 'pending',
                bookingId: 'BK' + Date.now()
            };
            
            try {
                // Save to both Firestore and Realtime Database
                await db.collection('bookings').add(bookingData);
                await database.ref('bookings').push(bookingData);
                
                                // Show success message
                const successDiv = document.createElement('div');
                successDiv.className = 'success-message';
                successDiv.innerHTML = '<i class="fas fa-check-circle"></i> Booking request submitted successfully! Booking ID: ' + bookingData.bookingId + '. We will contact you soon.';
                document.querySelector('.booking-card').insertBefore(successDiv, document.getElementById('bookingForm'));
                
                // Show weather info for destination
                const weather = getSimulatedWeather(currentTripLocation);
                const weatherDiv = document.createElement('div');
                weatherDiv.className = 'weather-info';
                weatherDiv.style.cssText = 'background: #e0f2fe; padding: 1rem; border-radius: 10px; margin: 1rem 0; color: #0277bd;';
                weatherDiv.innerHTML = `
                    <h4><i class="fas fa-cloud-sun"></i> Weather in ${weather.location}</h4>
                    <p>${weather.weather} • ${weather.temperature} • Humidity: ${weather.humidity}</p>
                `;
                document.querySelector('.booking-card').insertBefore(weatherDiv, document.getElementById('bookingForm'));
                
                document.getElementById('bookingForm').reset();
                
                // Send notification using free browser notification
                sendFreeNotification('Booking Confirmed!', `Your booking ${bookingData.bookingId} has been submitted successfully.`);
                
                // Add QR code and print option to success message
                const qrDiv = document.createElement('div');
                qrDiv.className = 'qr-section';
                qrDiv.style.cssText = 'text-align: center; margin: 1rem 0; padding: 1rem; background: white; border-radius: 10px;';
                qrDiv.innerHTML = `
                    <img src="${generateBookingQR(bookingData.bookingId)}" alt="Booking QR Code" style="max-width: 150px;">
                    <p style="margin: 0.5rem 0; color: #666;">Scan QR code for booking details</p>
                    <button class="btn btn-outline" onclick="printBookingDetails('${bookingData.bookingId}')" style="margin: 0.5rem;">
                        <i class="fas fa-print"></i> Print Booking
                    </button>
                    <button class="btn btn-outline" onclick="speakText('Your booking ${bookingData.bookingId} has been confirmed. Thank you for choosing TrekWanders!')" style="margin: 0.5rem;">
                        <i class="fas fa-volume-up"></i> Speak
                    </button>
                `;
                document.querySelector('.booking-card').insertBefore(qrDiv, document.getElementById('bookingForm'));
                
                // Remove success message after 10 seconds
                setTimeout(() => {
                    if (successDiv.parentNode) {
                        successDiv.parentNode.removeChild(successDiv);
                    }
                    if (weatherDiv.parentNode) {
                        weatherDiv.parentNode.removeChild(weatherDiv);
                    }
                    if (qrDiv.parentNode) {
                        qrDiv.parentNode.removeChild(qrDiv);
                    }
                }, 10000);
                
            } catch (error) {
                console.error('Booking error:', error);
                alert('Error submitting booking: ' + error.message);
            } finally {
                // Hide loading state
                document.getElementById('bookingLoading').style.display = 'none';
                submitBtn.disabled = false;
            }
        }

        async function handleReviewSubmit(e) {
            e.preventDefault();
            
            if (!currentUser) {
                alert('Please login to add a review.');
                return;
            }

            // Show loading state
            document.getElementById('reviewLoading').style.display = 'inline-block';
            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            
            const reviewData = {
                tripId: currentTripId,
                userId: currentUser.uid,
                userEmail: currentUser.email,
                userName: currentUser.displayName || currentUser.email.split('@')[0],
                rating: parseInt(document.getElementById('reviewRating').value),
                title: document.getElementById('reviewTitle').value,
                text: document.getElementById('reviewText').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                // Save to both Firestore and Realtime Database
                await db.collection('reviews').add(reviewData);
                await database.ref('reviews').push(reviewData);
                
                document.getElementById('reviewForm').reset();
                hideAddReviewForm();
                loadTripReviews(currentTripId);
                
                // Show success notification
                sendFreeNotification('Review Added', 'Your review has been posted successfully!', 'success');
                
            } catch (error) {
                console.error('Error adding review:', error);
                sendFreeNotification('Error', 'Failed to add review. Please try again.', 'error');
            } finally {
                // Hide loading state
                document.getElementById('reviewLoading').style.display = 'none';
                submitBtn.disabled = false;
            }
        }

        function showAddReviewForm() {
            if (!currentUser) {
                alert('Please login to add a review.');
                return;
            }
            document.getElementById('addReviewForm').style.display = 'block';
            document.getElementById('addReviewBtn').style.display = 'none';
        }

        function hideAddReviewForm() {
            document.getElementById('addReviewForm').style.display = 'none';
            document.getElementById('addReviewBtn').style.display = 'block';
        }

        async function loadTripReviews(tripId) {
            try {
                const reviews = await db.collection('reviews')
                    .where('tripId', '==', tripId)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const reviewsList = document.getElementById('reviewsList');
                reviewsList.innerHTML = '';
                
                reviews.forEach(doc => {
                    const review = doc.data();
                    const reviewCard = createReviewCard(review);
                    reviewsList.appendChild(reviewCard);
                });
            } catch (error) {
                console.error('Error loading reviews:', error);
            }
        }

        function createReviewCard(review) {
            const card = document.createElement('div');
            card.className = 'review-card';
            
            const stars = '★'.repeat(review.rating) + '☆'.repeat(5 - review.rating);
            const date = review.createdAt ? review.createdAt.toDate().toLocaleDateString() : 'Recently';
            
            card.innerHTML = `
                <div class="review-header">
                    <div class="reviewer-info">
                        <div class="reviewer-avatar">${review.userName[0].toUpperCase()}</div>
                        <div>
                            <div><strong>${review.userName}</strong></div>
                            <div class="stars">${stars}</div>
                        </div>
                    </div>
                    <div class="review-date">${date}</div>
                </div>
                <h4>${review.title}</h4>
                <p>${review.text}</p>
            `;
            
            return card;
        }

        async function loadTripsFromFirestore() {
            try {
                const snapshot = await db.collection('trips').orderBy('createdAt', 'desc').get();
                
                // Remove Firebase trips from allTrips array
                allTrips = allTrips.filter(trip => trip.id.startsWith('sample'));
                
                // Add Firebase trips
                snapshot.forEach(doc => {
                    const trip = { id: doc.id, ...doc.data() };
                    allTrips.push(trip);
                });
                
                filteredTrips = [...allTrips];
                renderTrips();
            } catch (error) {
                console.error('Error loading trips:', error);
            }
        }

        async function loadUsersList() {
            if (!isAdmin) return;
            
            try {
                const users = await db.collection('users').get();
                const usersList = document.getElementById('usersList');
                usersList.innerHTML = '';
                
                users.forEach(doc => {
                    const user = doc.data();
                    const userCard = createUserCard(doc.id, user);
                    usersList.appendChild(userCard);
                });
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        function createUserCard(userId, user) {
            const card = document.createElement('div');
            card.className = 'review-card';
            
            card.innerHTML = `
                <div class="review-header">
                    <div class="reviewer-info">
                        <div class="reviewer-avatar">${user.email[0].toUpperCase()}</div>
                        <div>
                            <div><strong>${user.email}</strong></div>
                            <div class="role-badge ${user.role === 'admin' ? 'admin' : ''}">${user.role}</div>
                        </div>
                    </div>
                    <div>
                        <select onchange="changeUserRole('${userId}', this.value)">
                            <option value="user" ${user.role === 'user' ? 'selected' : ''}>User</option>
                            <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Admin</option>
                        </select>
                    </div>
                </div>
            `;
            
            return card;
        }

        async function changeUserRole(userId, newRole) {
            if (!isAdmin) return;
            
            try {
                await db.collection('users').doc(userId).update({
                    role: newRole
                });
                alert('User role updated successfully!');
            } catch (error) {
                alert('Error updating user role: ' + error.message);
            }
        }

        async function deleteTrip(tripId) {
            if (!isAdmin || !confirm('Are you sure you want to delete this trip?')) return;
            
            try {
                await db.collection('trips').doc(tripId).delete();
                // Remove from local array
                allTrips = allTrips.filter(trip => trip.id !== tripId);
                filteredTrips = filteredTrips.filter(trip => trip.id !== tripId);
                renderTrips();
                document.getElementById('tripModal').style.display = 'none';
                alert('Trip deleted successfully!');
            } catch (error) {
                alert('Error deleting trip: ' + error.message);
            }
        }

        function editTrip(tripId) {
            if (!isAdmin) return;
            alert('Edit functionality would be implemented here. For now, please delete and recreate the trip.');
        }

        // Feed Functions
        function loadSampleFeedPosts() {
            const samplePosts = [
                {
                    id: 'sample-post-1',
                    title: 'Welcome to TrekWanders!',
                    content: 'We are excited to launch our new travel platform. Explore amazing destinations and create unforgettable memories with us. Our team is dedicated to providing you with the best travel experiences around the world.',
                    imageUrl: 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=600&h=300&fit=crop',
                    authorName: 'TrekWanders Team',
                    authorEmail: 'admin@trekwanders.com',
                    createdAt: new Date(),
                    likes: 24
                },
                {
                    id: 'sample-post-2',
                    title: 'New Himalayan Trek Routes Available',
                    content: 'We have added exciting new trekking routes in the Himalayas. These carefully curated paths offer breathtaking views and authentic cultural experiences. Book your adventure today!',
                    imageUrl: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=600&h=300&fit=crop',
                    authorName: 'Adventure Team',
                    authorEmail: 'admin@trekwanders.com',
                    createdAt: new Date(Date.now() - 86400000), // 1 day ago
                    likes: 18
                }
            ];

            renderFeedPosts(samplePosts);
        }

        function renderFeedPosts(posts) {
            const feedContainer = document.getElementById('feedPosts');
            feedContainer.innerHTML = '';

            posts.forEach(post => {
                const postElement = createFeedPostElement(post);
                feedContainer.appendChild(postElement);
            });
        }

        function createFeedPostElement(post) {
            const postDiv = document.createElement('div');
            postDiv.className = 'feed-post';
            
            const createdDate = post.createdAt instanceof Date ? post.createdAt : post.createdAt.toDate();
            const timeAgo = getTimeAgo(createdDate);

            postDiv.innerHTML = `
                <div class="post-header">
                    <div class="post-avatar">${post.authorName[0].toUpperCase()}</div>
                    <div class="post-info">
                        <h4>${post.authorName}</h4>
                        <div class="post-date">${timeAgo}</div>
                    </div>
                </div>
                <div class="post-content">
                    <h3>${post.title}</h3>
                    <p>${post.content}</p>
                    ${post.imageUrl ? `<img src="${post.imageUrl}" alt="Post image" class="post-image">` : ''}
                </div>
                <div class="post-actions">
                    <div class="post-action" onclick="likePost('${post.id}')">
                        <i class="fas fa-heart"></i>
                        <span>${post.likes || 0} Likes</span>
                    </div>
                    <div class="post-action">
                        <i class="fas fa-comment"></i>
                        <span>Comment</span>
                    </div>
                    <div class="post-action">
                        <i class="fas fa-share"></i>
                        <span>Share</span>
                    </div>
                </div>
            `;

            return postDiv;
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} minutes ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} hours ago`;
            if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)} days ago`;
            
            return date.toLocaleDateString();
        }

        function showAddPostForm() {
            if (!isAdmin) {
                alert('Only admins can create posts.');
                return;
            }
            document.getElementById('addPostForm').style.display = 'block';
            document.getElementById('addPostBtn').style.display = 'none';
        }

        function hideAddPostForm() {
            document.getElementById('addPostForm').style.display = 'none';
            document.getElementById('addPostBtn').style.display = 'inline-block';
        }

        async function handleFeedPostSubmit(e) {
            e.preventDefault();
            
            if (!isAdmin) {
                alert('Only admins can create posts.');
                return;
            }

            const postData = {
                title: document.getElementById('postTitle').value,
                content: document.getElementById('postContent').value,
                imageUrl: document.getElementById('postImage').value,
                authorName: currentUser.displayName || currentUser.email.split('@')[0],
                authorEmail: currentUser.email,
                authorId: currentUser.uid,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                likes: 0
            };

            try {
                await db.collection('feed').add(postData);
                document.getElementById('feedPostForm').reset();
                hideAddPostForm();
                loadFeedPosts();
                
                // Show success message
                const successDiv = document.createElement('div');
                successDiv.className = 'success-message';
                successDiv.innerHTML = '<i class="fas fa-check-circle"></i> Post created successfully!';
                document.querySelector('.feed-section .container').insertBefore(successDiv, document.getElementById('feedPosts'));
                
                setTimeout(() => {
                    if (successDiv.parentNode) {
                        successDiv.parentNode.removeChild(successDiv);
                    }
                }, 3000);
                
            } catch (error) {
                alert('Error creating post: ' + error.message);
            }
        }

        async function loadFeedPosts() {
            try {
                const snapshot = await db.collection('feed').orderBy('createdAt', 'desc').get();
                const posts = [];
                
                snapshot.forEach(doc => {
                    posts.push({ id: doc.id, ...doc.data() });
                });

                renderFeedPosts(posts);
            } catch (error) {
                console.error('Error loading feed posts:', error);
                // Load sample posts if Firebase fails
                loadSampleFeedPosts();
            }
        }

        async function likePost(postId) {
            if (!currentUser) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Login Required',
                    text: 'Please login to like posts.',
                    confirmButtonColor: '#2563eb'
                });
                return;
            }
            
            try {
                const likeRef = database.ref('likes/' + postId + '/' + currentUser.uid);
                const snapshot = await likeRef.once('value');
                
                if (snapshot.exists()) {
                    // Unlike the post
                    await likeRef.remove();
                    await database.ref('feed/' + postId + '/likes').transaction(current => (current || 1) - 1);
                } else {
                    // Like the post
                    await likeRef.set({
                        userId: currentUser.uid,
                        userEmail: currentUser.email,
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                    await database.ref('feed/' + postId + '/likes').transaction(current => (current || 0) + 1);
                }
                
                // Reload feed to update like counts
                loadFeedPosts();
                
            } catch (error) {
                console.error('Error liking post:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to like post. Please try again.',
                    confirmButtonColor: '#2563eb'
                });
            }
        }

        // Free notification system using browser notifications and Toastify
        function sendFreeNotification(title, message, type = 'success') {
            // Browser notification (free and unlimited)
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    new Notification(title, {
                        body: message,
                        icon: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=64&h=64&fit=crop'
                    });
                } else if (Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            new Notification(title, {
                                body: message,
                                icon: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=64&h=64&fit=crop'
                            });
                        }
                    });
                }
            }
            
            // Toastify notification (free and unlimited)
            Toastify({
                text: `${title}: ${message}`,
                duration: 5000,
                gravity: "top",
                position: "right",
                backgroundColor: type === 'success' ? "#10b981" : type === 'error' ? "#ef4444" : "#2563eb",
                stopOnFocus: true,
                onClick: function(){}
            }).showToast();
        }

        // Free weather simulation (no API required)
        function getSimulatedWeather(location) {
            const weatherTypes = ['Sunny', 'Cloudy', 'Rainy', 'Partly Cloudy', 'Clear'];
            const temperatures = [15, 18, 22, 25, 28, 30, 32];
            
            return {
                location: location,
                weather: weatherTypes[Math.floor(Math.random() * weatherTypes.length)],
                temperature: temperatures[Math.floor(Math.random() * temperatures.length)] + '°C',
                humidity: Math.floor(Math.random() * 40) + 40 + '%',
                windSpeed: Math.floor(Math.random() * 15) + 5 + ' km/h'
            };
        }

        // Free currency conversion simulation (no API required)
        function simulateCurrencyConversion(amount, fromCurrency = 'USD', toCurrency = 'EUR') {
            const exchangeRates = {
                'USD': { 'EUR': 0.85, 'GBP': 0.73, 'JPY': 110, 'INR': 75, 'CAD': 1.25 },
                'EUR': { 'USD': 1.18, 'GBP': 0.86, 'JPY': 130, 'INR': 88, 'CAD': 1.47 },
                'GBP': { 'USD': 1.37, 'EUR': 1.16, 'JPY': 151, 'INR': 102, 'CAD': 1.71 }
            };
            
            if (exchangeRates[fromCurrency] && exchangeRates[fromCurrency][toCurrency]) {
                const convertedAmount = (amount * exchangeRates[fromCurrency][toCurrency]).toFixed(2);
                return { amount: convertedAmount, currency: toCurrency, rate: exchangeRates[fromCurrency][toCurrency] };
            }
            
            return { amount: amount, currency: fromCurrency, rate: 1 };
        }

        // Free location services using browser geolocation
        function getUserLocation() {
            return new Promise((resolve, reject) => {
                if ('geolocation' in navigator) {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            resolve({
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude,
                                accuracy: position.coords.accuracy
                            });
                        },
                        error => reject(error),
                        {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 600000
                        }
                    );
                } else {
                    reject(new Error('Geolocation not supported'));
                }
            });
        }

        // Enhanced user role management
        async function changeUserRole(userId, newRole) {
            if (!isAdmin) {
                Swal.fire({
                    icon: 'error',
                    title: 'Access Denied',
                    text: 'Only admins can change user roles.',
                    confirmButtonColor: '#2563eb'
                });
                return;
            }
            
            try {
                await database.ref('users/' + userId + '/role').set(newRole);
                
                Swal.fire({
                    icon: 'success',
                    title: 'Success!',
                    text: 'User role updated successfully!',
                    confirmButtonColor: '#2563eb'
                });
                
                loadUsersList();
            } catch (error) {
                console.error('Error updating user role:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to update user role: ' + error.message,
                    confirmButtonColor: '#2563eb'
                });
            }
                 }

         // Free utility functions (no API required)
         
         // Generate QR Code for bookings (free library)
         function generateBookingQR(bookingId) {
             const qrData = `TrekWanders Booking: ${bookingId}`;
             const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(qrData)}`;
             return qrUrl;
         }

         // Free image optimization
         function optimizeImageUrl(url, width = 800, height = 600) {
             if (url.includes('unsplash.com')) {
                 return `${url}?w=${width}&h=${height}&fit=crop&crop=center`;
             }
             return url;
         }

         // Local storage for offline functionality
         function saveToLocalStorage(key, data) {
             try {
                 localStorage.setItem(key, JSON.stringify(data));
                 return true;
             } catch (error) {
                 console.error('Failed to save to localStorage:', error);
                 return false;
             }
         }

         function getFromLocalStorage(key) {
             try {
                 const data = localStorage.getItem(key);
                 return data ? JSON.parse(data) : null;
             } catch (error) {
                 console.error('Failed to get from localStorage:', error);
                 return null;
             }
         }

         // Free text-to-speech functionality
         function speakText(text) {
             if ('speechSynthesis' in window) {
                 const utterance = new SpeechSynthesisUtterance(text);
                 utterance.rate = 0.8;
                 utterance.pitch = 1;
                 utterance.volume = 0.8;
                 speechSynthesis.speak(utterance);
             }
         }

         // Free image gallery with keyboard navigation
         function initImageGallery() {
             document.addEventListener('keydown', function(e) {
                 if (document.getElementById('tripModal').style.display === 'flex') {
                     if (e.key === 'ArrowLeft') {
                         previousImage();
                     } else if (e.key === 'ArrowRight') {
                         nextImage();
                     } else if (e.key === 'Escape') {
                         document.getElementById('tripModal').style.display = 'none';
                     }
                 }
             });
         }

         // Free print functionality
         function printBookingDetails(bookingId) {
             const printWindow = window.open('', '_blank');
             printWindow.document.write(`
                 <html>
                 <head>
                     <title>TrekWanders Booking - ${bookingId}</title>
                     <style>
                         body { font-family: Arial, sans-serif; padding: 20px; }
                         .header { text-align: center; margin-bottom: 30px; }
                         .booking-details { border: 1px solid #ddd; padding: 20px; border-radius: 10px; }
                         .qr-code { text-align: center; margin-top: 20px; }
                     </style>
                 </head>
                 <body>
                     <div class="header">
                         <h1>TrekWanders</h1>
                         <h2>Booking Confirmation</h2>
                     </div>
                     <div class="booking-details">
                         <h3>Booking ID: ${bookingId}</h3>
                         <p>Thank you for booking with TrekWanders!</p>
                         <p>Date: ${new Date().toLocaleDateString()}</p>
                         <div class="qr-code">
                             <img src="${generateBookingQR(bookingId)}" alt="Booking QR Code">
                             <p>Scan this QR code for quick access to your booking</p>
                         </div>
                     </div>
                 </body>
                 </html>
             `);
             printWindow.document.close();
             printWindow.print();
         }

         // Hero search function
         function searchTrips() {
             const location = document.getElementById('heroSearchInput').value;
             const date = document.getElementById('heroDateInput').value;
             
             if (location) {
                 // Filter trips by location
                 filteredTrips = allTrips.filter(trip => 
                     trip.location.toLowerCase().includes(location.toLowerCase()) ||
                     trip.title.toLowerCase().includes(location.toLowerCase())
                 );
                 renderTrips();
                 document.getElementById('destinations').scrollIntoView();
                 sendFreeNotification('Search Results', `Found ${filteredTrips.length} trips for "${location}"`, 'info');
             } else {
                 sendFreeNotification('Search Error', 'Please enter a destination to search', 'error');
             }
         }

         // Initialize free features
         function initializeFreeFeatures() {
             // Initialize image gallery
             initImageGallery();
             
             // Add keyboard shortcuts
             document.addEventListener('keydown', function(e) {
                 if (e.ctrlKey || e.metaKey) {
                     switch(e.key) {
                         case 's':
                             e.preventDefault();
                             if (currentUser && isAdmin) {
                                 document.getElementById('adminPanel').scrollIntoView();
                             }
                             break;
                     }
                 }
             });
         }

         // Smooth scrolling for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>